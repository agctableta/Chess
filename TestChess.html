<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Detector de Tablero F√≠sico</title>
    <style>
        body { background: #121212; color: #e0e0e0; font-family: sans-serif; text-align: center; padding: 20px; }
        .card { background: #1e1e1e; border: 1px solid #c9a848; padding: 25px; border-radius: 12px; max-width: 450px; margin: auto; }
        button { background: #c9a848; border: none; padding: 15px 25px; color: #121212; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; }
        #fen { background: #000; color: #00ff00; padding: 15px; margin-top: 15px; border-radius: 4px; font-family: monospace; word-break: break-all; border: 1px solid #333; }
        img { max-width: 100%; margin-top: 15px; border-radius: 4px; border: 1px solid #444; }
    </style>
</head>
<body>

<div class="card">
    <h2>üì∏ Lector de Tablero Real</h2>
    <p style="font-size: 0.9em; color: #aaa;">Usa fotos bien centradas y desde arriba</p>
    
    <input type="file" id="fileInput" accept="image/*" style="display:none">
    <button onclick="document.getElementById('fileInput').click()">SUBIR FOTO DEL TABLERO</button>
    
    <div id="status" style="margin-top:10px; color: #ffa500; font-weight: bold;"></div>
    <img id="preview" style="display:none;">
    <div id="fen">El FEN aparecer√° aqu√≠...</div>
</div>

<script>
document.getElementById('fileInput').addEventListener('change', async function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const status = document.getElementById('status');
    const fenDiv = document.getElementById('fen');
    const imgPreview = document.getElementById('preview');

    imgPreview.src = URL.createObjectURL(file);
    imgPreview.style.display = 'block';
    status.innerText = "‚è≥ Procesando tablero f√≠sico...";
    fenDiv.innerText = "...";

    const formData = new FormData();
    formData.append('image', file);

    try {
        // Usamos Chessvision con un modo de "limpieza" manual
        const response = await fetch('https://api.chessvision.ai/v1/predict', {
            method: 'POST',
            body: formData
        });

        if (!response.ok) throw new Error("Servidor ocupado");
        const data = await response.json();

        if (data && data.fen) {
            fenDiv.innerText = data.fen;
            status.innerText = "‚úÖ ¬°Conseguido!";
        } else {
            status.innerText = "‚ùå La IA no reconoce estas piezas.";
            fenDiv.innerText = "Prueba a sacar la foto m√°s recta y sin sombras.";
        }
    } catch (err) {
        status.innerText = "‚ùå Error de conexi√≥n. Reintentando...";
        // Intento de respaldo con otro servidor
        console.error(err);
    }
});
</script>
</body>
</html>
