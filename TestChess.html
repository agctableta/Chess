<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>S√∫per FEN Detector</title>
    <style>
        body { background: #1a1a1a; color: #f0d9b5; font-family: 'Segoe UI', sans-serif; text-align: center; padding: 40px; }
        .box { background: #2a2a2a; border: 2px solid #c9a848; padding: 20px; border-radius: 10px; display: inline-block; max-width: 90%; }
        button { background: #c9a848; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; border-radius: 5px; }
        #fenDisplay { background: #000; padding: 15px; margin-top: 20px; border-radius: 5px; color: #00ff00; font-family: monospace; }
        img { max-width: 300px; margin-top: 15px; border-radius: 5px; display: none; margin-left: auto; margin-right: auto; }
    </style>
</head>
<body>

<div class="box">
    <h2>üì∏ Extractor de FEN</h2>
    <p>Sube la captura de tu partida</p>
    
    <input type="file" id="fileInput" accept="image/*" style="display:none">
    <button onclick="document.getElementById('fileInput').click()">ELEGIR IMAGEN</button>
    
    <div id="status">Estado: Esperando...</div>
    <img id="preview">
    <div id="fenDisplay">El c√≥digo FEN aparecer√° aqu√≠</div>
</div>

<script>
document.getElementById('fileInput').addEventListener('change', async function(e) {
    const file = e.target.files[0];
    if (!file) return;

    // Vista previa
    const img = document.getElementById('preview');
    img.src = URL.createObjectURL(file);
    img.style.display = 'block';

    const status = document.getElementById('status');
    const display = document.getElementById('fenDisplay');
    
    status.innerText = "‚è≥ La IA est√° leyendo el tablero...";
    display.innerText = "Cargando...";

    const formData = new FormData();
    formData.append('file', file);

    try {
        // CAMBIO DE ESTRATEGIA: Usamos Chess-OCR que es m√°s abierto
        const response = await fetch('https://worker-chess-ocr.chess-ai.workers.dev/', {
            method: 'POST',
            body: formData
        });

        const data = await response.json();

        if (data.fen) {
            display.innerText = data.fen;
            status.innerText = "‚úÖ ¬°Conseguido!";
        } else {
            display.innerText = "No se pudo extraer el FEN.";
            status.innerText = "‚ùå Intenta con otra foto";
        }
    } catch (err) {
        console.error(err);
        status.innerText = "‚ùå Error de conexi√≥n";
        display.innerText = "El servidor est√° ocupado. Prueba en 1 minuto.";
    }
});
</script>

</body>
</html>
