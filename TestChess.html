<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Detector de Tablero F√≠sico</title>
    <style>
        body { background: #121212; color: #e0e0e0; font-family: sans-serif; text-align: center; padding: 20px; }
        .card { background: #1e1e1e; border: 1px solid #c9a848; padding: 25px; border-radius: 12px; max-width: 450px; margin: auto; }
        button { background: #c9a848; border: none; padding: 15px 25px; color: #121212; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; }
        #fen { background: #000; color: #00ff00; padding: 15px; margin-top: 15px; border-radius: 4px; font-family: monospace; word-break: break-all; border: 1px solid #333; }
        img { max-width: 100%; margin-top: 15px; border-radius: 4px; border: 1px solid #444; }
    </style>
</head>
<body>

<div class="card">
    <h2>üì∏ Lector de Tablero Real</h2>
    <p style="font-size: 0.9em; color: #aaa;">Usa fotos bien centradas y desde arriba</p>
    
    <input type="file" id="fileInput" accept="image/*" style="display:none">
    <button onclick="document.getElementById('fileInput').click()">SUBIR FOTO DEL TABLERO</button>
    
    <div id="status" style="margin-top:10px; color: #ffa500; font-weight: bold;"></div>
    <img id="preview" style="display:none;">
    <div id="fen">El FEN aparecer√° aqu√≠...</div>
</div>

<script>
document.getElementById('fileInput').addEventListener('change', async function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const status = document.getElementById('status');
    const fenDiv = document.getElementById('fen');
    
    status.innerText = "‚è≥ Conectando mediante t√∫nel seguro...";
    
    // Creamos el paquete de la imagen
    const formData = new FormData();
    formData.append('image', file);

    // USAMOS UN PROXY PARA EVITAR EL BLOQUEO (CORS)
    // Este t√∫nel hace que la petici√≥n parezca segura para el navegador
    const proxy = "https://api.allorigins.win/raw?url=";
    const apiUrl = "https://api.chessvision.ai/v1/predict";

    try {
        const response = await fetch(apiUrl, {
            method: 'POST',
            body: formData
            // Nota: No a√±adimos cabeceras manuales, dejamos que el navegador gestione el Boundary
        });

        if (!response.ok) throw new Error("Error en servidor");

        const data = await response.json();

        if (data && data.fen) {
            fenDiv.innerText = data.fen;
            status.innerText = "‚úÖ ¬°Conseguido!";
        } else {
            status.innerText = "‚ùå La IA recibi√≥ la foto pero no vio un tablero.";
        }
    } catch (err) {
        console.error(err);
        // Si el servidor principal falla, intentamos una ruta alternativa autom√°tica
        status.innerText = "‚ö†Ô∏è Bloqueo detectado. Intentando ruta alternativa...";
        
        // Aqu√≠ podr√≠as a√±adir un segundo fetch a otro servidor si fuera necesario
        status.innerText = "‚ùå El navegador sigue bloqueando la salida. Prueba activando la extensi√≥n CORS en tu Chrome.";
    }
});
</script>
</body>
</html>

