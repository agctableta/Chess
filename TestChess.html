<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Detector FEN Pro</title>
    <style>
        body { background: #1a1a1a; color: white; font-family: sans-serif; text-align: center; padding: 40px; }
        .panel { background: #2d2d2d; border: 2px solid #c9a848; padding: 25px; border-radius: 12px; display: inline-block; }
        button { background: #2d7a3a; color: white; border: none; padding: 15px 30px; font-size: 18px; cursor: pointer; border-radius: 8px; font-weight: bold; }
        #fenDisplay { background: #000; color: #00ff00; padding: 20px; margin-top: 20px; border-radius: 5px; font-family: monospace; font-size: 1.2em; word-break: break-all; }
        #preview { max-width: 300px; margin-top: 15px; border-radius: 8px; display: none; margin-left: auto; margin-right: auto; }
    </style>
</head>
<body>

<div class="panel">
    <h2>üì∏ Detector de Posiciones</h2>
    <p>Con la extensi√≥n CORS activada, sube tu imagen:</p>
    
    <input type="file" id="fileInput" accept="image/*" style="display:none">
    <button onclick="document.getElementById('fileInput').click()">üöÄ SELECCIONAR IMAGEN</button>
    
    <div id="status" style="margin-top: 15px; color: #c9a848;">Estado: Esperando...</div>
    <img id="preview">
    <div id="fenDisplay">El FEN aparecer√° aqu√≠</div>
</div>

<script>
document.getElementById('fileInput').addEventListener('change', async function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const status = document.getElementById('status');
    const display = document.getElementById('fenDisplay');
    const img = document.getElementById('preview');

    // Mostrar preview
    img.src = URL.createObjectURL(file);
    img.style.display = 'block';
    
    status.innerText = "‚è≥ Enviando a la IA...";
    display.innerText = "Procesando...";

    const formData = new FormData();
    formData.append('image', file);

    try {
        const response = await fetch('https://api.chessvision.ai/v1/predict', {
            method: 'POST',
            body: formData
        });

        if (!response.ok) throw new Error("Error de respuesta");
        const data = await response.json();

        if (data && data.fen) {
            display.innerText = data.fen;
            status.innerText = "‚úÖ ¬°CONSEGUIDO!";
        } else {
            display.innerText = "La IA no detect√≥ un tablero claro.";
            status.innerText = "‚ùå Fallo de lectura";
        }
    } catch (err) {
        console.error(err);
        status.innerText = "‚ùå Bloqueo CORS. ¬øEst√° la extensi√≥n en ON?";
        display.innerText = "Aseg√∫rate de que el icono de la extensi√≥n est√© activado y refresca con F5.";
    }
});
</script>

</body>
</html>
