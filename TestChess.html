<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Detector de Tablero Real</title>
    <style>
        body { background: #121212; color: #e0e0e0; font-family: sans-serif; text-align: center; padding: 20px; }
        .card { background: #1e1e1e; border: 1px solid #333; padding: 25px; border-radius: 8px; max-width: 450px; margin: auto; }
        button { background: #4CAF50; border: none; padding: 12px 20px; color: white; border-radius: 4px; cursor: pointer; font-size: 16px; }
        #fen { background: #000; color: #00ff00; padding: 15px; margin-top: 15px; border-radius: 4px; font-family: monospace; min-height: 20px; word-break: break-all; }
        img { max-width: 100%; margin-top: 15px; display: none; border: 1px solid #444; }
    </style>
</head>
<body>

<div class="card">
    <h2>üì∏ Lector de Tablero F√≠sico</h2>
    <input type="file" id="fileInput" accept="image/*" style="display:none">
    <button onclick="document.getElementById('fileInput').click()">Subir Foto del Tablero</button>
    
    <div id="status" style="margin-top:10px; color: #ffa500;"></div>
    <img id="preview">
    <div id="fen">El FEN aparecer√° aqu√≠...</div>
</div>

<script>
document.getElementById('fileInput').addEventListener('change', async function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const status = document.getElementById('status');
    const fenDiv = document.getElementById('fen');
    const img = document.getElementById('preview');

    img.src = URL.createObjectURL(file);
    img.style.display = 'block';
    status.innerText = "‚è≥ Analizando (esto puede tardar 10s)...";
    fenDiv.innerText = "...";

    const formData = new FormData();
    formData.append('file', file);

    try {
        // Probamos con un servicio alternativo de respaldo
        const response = await fetch('https://chess-ocr.com/api/v1/scan', {
            method: 'POST',
            body: formData
        });

        const data = await response.json();

        if (data && data.fen) {
            fenDiv.innerText = data.fen;
            status.innerText = "‚úÖ ¬°Conseguido!";
        } else {
            // Si falla, intentamos el segundo servidor autom√°ticamente
            status.innerText = "üîÑ Reintentando con servidor de respaldo...";
            const res2 = await fetch('https://worker-chess-ocr.chess-ai.workers.dev/', {
                method: 'POST',
                body: formData
            });
            const data2 = await res2.json();
            if(data2.fen) {
                fenDiv.innerText = data2.fen;
                status.innerText = "‚úÖ ¬°Conseguido!";
            } else {
                status.innerText = "‚ùå No se pudo leer. Intenta una foto m√°s recta.";
            }
        }
    } catch (err) {
        status.innerText = "‚ùå Error de conexi√≥n. Revisa que est√©s en HTTPS.";
    }
});
</script>
</body>
</html>
